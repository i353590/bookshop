const cds = require('../cds')

const search2cqn4sql = require('./search2cqn4sql')

function handler(req) {
  // REVISIT: remove feature toggle optimized_search after grace period
  // inject the search2cqn4sql module into the rewrite handler only when
  // the optimized search feature toggle is turned on
  if (req.query && cds.env.features.optimized_search) {
    Object.defineProperty(req.query, '_searchOptions', { value: { search2cqn4sql, locale: req.locale } })
  }
}

// handlers marked with `._initial = true` run in sequence
handler._initial = true
module.exports = handler
